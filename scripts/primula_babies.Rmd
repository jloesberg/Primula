---
title: "Primula babies data cleaning"
output: html_notebook
---

_What this script does:_
- figures out the miscellaneous bits of the IPM (doing it in a separate location so that it doesnt muck up the main IPM file - later I will just source this for all the values)

```{r read in }
library(tidyverse)

# Add in demography data:
source("../scripts/dode_allyears_cleaned.R")
#adding treatment
#read in data that assign treatment to plot
plots<-read.csv("/Users/Jenna/Dropbox/Williams' Lab/Cowichan IDE/Data & Plot Info/IDE_plotinfo.csv", header=T)

plots <- plots %>% 
  mutate(plot = as.character(plot))
```


March 29, 2023 to do:

We've mapped out the life cycle diagram and the matrices, but there are lots of little bits to figure out before I can stick them in

They are:

    
    
- The number of seeds produced when seeds are made
    - The data we have for this: resurvey and seed counts in 2021, 2022 [size of capsules - I need to do     some thinking for this], (2023)
    - Will this be plot or treatment specific? Will need to see how variable it is 
    
```{r}
#2021 data
clip <- read.csv("../data/2021_Primula_Clipping.csv")
clip <- clip %>% 
  select(1:8, -c(coor, date.of.clipping)) %>% 
  mutate(tag = as.character(tag),
         plot = as.character(plot),
         initial.flower = no.flowers.at.start +no.buds.at.start)

seeds21 <- read.csv("C:/Users/Jenna/Dropbox/Williams' Lab/Cowichan IDE/Cowichan_DemographyData/Dodecatheon/2021_Dodecatheon_Seed_Counts.csv")
#I want 2 data sets from this:
## 1) seeds per capsule with capsule area
## 2) seeds per plant

#volume of a prolate ellipsoid: 
### 4/3*pi*a*b^2
seeds21 <- seeds21 %>% 
  mutate(plot = as.character(plot),
         tag = as.character(tag),
         pseeds = if_else(no.seeds > 0, 1, 0),
         cap.area = 4/3*pi*(capsule.L/2)*(capsule.W/2)*(capsule.W/2),#this is actuall volume!
         #cap.area = pi*(capsule.L/2)*(capsule.W/2),
         year = "2021")
seeds21$pseeds[is.na(seeds21$pseeds)] <- 1 #assuming the plants where we couldn't count capsules separately had all their capsules contribute to seed total
seeds21 <- left_join(seeds21, plots)


cap <- seeds21 %>% group_by(tag, plot) %>% 
  dplyr::summarize(no.success.cap = sum(pseeds),
            total.seeds = sum(no.seeds))
cap$total.seeds[cap$tag == 1556] <- 29
cap$total.seeds[cap$tag == 1988] <- 58
cap$total.seeds[cap$tag == 282] <- 50
cap$total.seeds[cap$tag == 494] <-98

#adding cap to the clip df

cap <- full_join(clip, cap) %>% 
  mutate(total.seeds = if_else(no.success.cap == 0, 0, total.seeds))
cap$total.seeds[is.na(cap$total.seeds)] <- 0
cap$no.success.cap[is.na(cap$no.success.cap)] <- 0
cap$initial.flower[cap$tag == 1490] <- 6
cap$initial.flower[cap$tag == 5769] <- 5
cap$initial.flower[cap$tag == 962] <- 6
cap$initial.flower[cap$tag == 5746] <- 5
cap$no.success.cap[cap$tag == 540] <- 4
cap$no.success.cap[cap$tag == 693] <- 2
seedset21 <- cap %>% 
  mutate(seed.set = no.success.cap/initial.flower,
         year = "2021") %>% 
  select(year, plot, tag, initial.flower, no.success.cap, seed.set) %>% 
  rename(no.successful.cap = no.success.cap,
         no.at.start = initial.flower)
remove(clip)
survey21.end <- cap %>% 
  select(c(plot, tag, initial.flower, no.success.cap))
```



```{r}
#2022 just measured capsule sizes:

#get data frame with just number of flowers in demog
flowers22 <- Dodecatheon %>% 
  filter(year == "2022") %>% 
  select(c(1:3), no.flowers) 

seeds22 <- read.csv("C:/Users/Jenna/Dropbox/Williams' Lab/Cowichan IDE/Cowichan_DemographyData/Dodecatheon/2022_Dodecatheon_Capsule_Measurements.csv")
seeds22 <- seeds22 %>% 
  mutate(cap.area = 4/3*pi*(capsule.L/2)*(capsule.W/2)*(capsule.W/2),
         year = "2022",
         year = as.character(year))
seeds22$pseeds <- 1
seeds22$pseeds[is.na(seeds22$cap.area)] <- 0 
seedset22 <- seeds22 %>% 
  group_by(plot, tag) %>% 
  summarize(no.successful.cap = sum(pseeds)) 
seedset22 <- seedset22 %>% 
  mutate(plot = as.character(plot))

seedset22 <- left_join(seedset22, flowers22) %>% 
  rename(no.at.start=no.flowers) %>% 
  mutate(seed.set = ifelse(no.at.start == 0, 0, no.successful.cap/no.at.start)) %>% 
  filter(tag!="div")
#seedset22[is.na(seedset22)] <- 0


seeds22 <- seeds22 %>% 
  mutate(plot = as.character(plot))
seeds22 <- left_join(seeds22, plots)
# seedset22 <- seeds22 %>% 
#   mutate(pseeds = if_else(no.seeds > 0, 1, 0)) %>% 
# 
#   group_by(tag, plot) %>% 
#   dplyr::summarize(no.success.cap = sum(pseeds))



#2023 just measured capsule sizes:
seeds23 <- read.csv("C:/Users/Jenna/Dropbox/Williams' Lab/Cowichan IDE/Cowichan_DemographyData/Dodecatheon/2023_Dodecatheon_Capsule_Measurements.csv")
seeds23 <- seeds23 %>% 
  mutate(plot = as.character(plot),
         tag = as.character(tag),
         year = "2023")
seedset23 <- seeds23 %>% 
  mutate(seed.set = ifelse(no.at.start == 0, 0, no.successful.cap/no.at.start),
         plot = as.character(plot),
         tag = as.character(tag)) %>% 
  select(c(year, plot, tag,no.successful.cap, no.at.start,seed.set)) %>% 
  group_by(tag) %>% 
  slice(1)
survey23.end <- seedset23
seedset <- bind_rows(seedset21, seedset22, seedset23)
remove(seedset21, seedset22, seedset23)

seeds23 <- left_join(seeds23, plots)
seeds23 <- seeds23 %>% select(1:5, trt, year) %>% 
  mutate(cap.area = 4/3*pi*(capsule.L/2)*(capsule.W/2)*(capsule.W/2))
```

```{r}
###
seeds21.model <- seeds21 %>% 
  filter(seeds.lost != "Y") %>% 
  filter(no.seeds>0,
         cap.area < .5)
ggplot(seeds21.model, aes(cap.area, no.seeds))+
  geom_point()+
  geom_smooth(method="glm", method.args=list(family="poisson"), se = F)+
  facet_wrap(~trt)
# ggplot(seeds21.model, aes(cap.vol, no.seeds))+
#   geom_point()+
#   geom_smooth(method="glm", method.args=list(family="poisson"), se = F)+
#   facet_wrap(~trt)

#seed <- glm(no.seeds~cap.area, data = seeds21, family = "poisson")
#summary(seed)
seed.trt <- glm(no.seeds~cap.area + trt, data = seeds21, family = "poisson")
summary(seed.trt)
seed.trt.1 <- glm(no.seeds~cap.area*trt, data = seeds21.model, family = "poisson")
summary(seed.trt.1)
coef(seed.trt.1)

#gettign no.seeds per capsule
#using model from above to get no.seeds:
tot.seeds <- bind_rows(seeds22, seeds23)


reg<- as.data.frame(predict(seed.trt, newdata = tot.seeds, type = "response"))
colnames(reg)[1] <- "no.seeds"
tot.seeds <- cbind(tot.seeds, reg)
remove(reg)

tot.seeds <- bind_rows(tot.seeds, seeds21)
# seeds22 <- seeds22 %>% 
#   mutate(no.seeds = ceiling(no.seeds),
#          pseeds = if_else(no.seeds > 0, 1, 0))
# seeds22$pseeds[is.na(seeds22$pseeds)] <- 0 
#seeds22$no.seeds[is.na(seeds22$no.seeds)] <- 0
#ok great, now I have no.seeds for 2022 (for all of the plants that made seeds!)


#tot.seeds <- full_join(seeds21, seeds22)


tot.seeds <- tot.seeds %>% group_by(year, tag, plot, trt) %>% 
  summarize(#no.success.cap = sum(pseeds),
            total.seeds = sum(no.seeds, na.rm = T)) %>% 
  mutate(total.seeds = round(total.seeds, 0))
#these are ones where I didnt count seeds separately in each capsule
tot.seeds$total.seeds[tot.seeds$tag == 1556 & tot.seeds$year == "2021"] <- 29
tot.seeds$total.seeds[tot.seeds$tag == 1988 & tot.seeds$year == "2021"] <- 58
tot.seeds$total.seeds[tot.seeds$tag == 1988 & tot.seeds$year == "2021"] <- 58
tot.seeds$total.seeds[tot.seeds$tag == 282 & tot.seeds$year == "2021"] <- 50
tot.seeds$total.seeds[tot.seeds$tag == 494 & tot.seeds$year == "2021"] <-98

#adding pseeds back in:
# tot.seeds <- tot.seeds %>% 
#   mutate(pseeds = if_else(total.seeds>0, 1, 0),
#          pseeds = as.character(pseeds))
#693 did make seeds, just don't know how much
#tot.seeds$pseeds[tot.seeds$tag == 693 & tot.seeds$year == "2021"] <-"1"
#write.csv(tot.seeds, "C:/Users/Jenna/Dropbox/Williams' Lab/Cowichan IDE/Cowichan_DemographyData/Dodecatheon/Dodecatheon_Seed_Counts.csv", row.names = F) #this is seed counts for 2021-2023
tot.seeds <- tot.seeds %>% 
  mutate(plot= as.character(plot),
         year = as.character(year))

remove(seeds21, seeds22, seed.trt.1, seeds21.model)
Dodecatheon <- left_join(Dodecatheon, tot.seeds) #add it to main demography file
#ok, done!
#tot.seeds is the end df - it has no.seeds made by all flowering plants in 2021 and 2023
```

###

```{r}
#if you make seeds, how many do you make
#Now, make a model for number of seeds produced:
#first some graphs
ggplot(subset(Dodecatheon, total.seeds >0), aes(x = log.ros.area, y = total.seeds))+
  geom_point()+
  geom_smooth(method="glm", method.args=list(family="poisson"), se = F)+
  facet_wrap(~trt)

#is it size dependent?

s <- glmer(total.seeds~1+(1|plot), data = subset(Dodecatheon, total.seeds >0), family = "poisson")
s1 <- glmer(total.seeds~log.ros.area + (1|plot), data = subset(Dodecatheon, total.seeds >0), family = "poisson")
anova(s, s1, test="Chisq") #LTR test
#yes, size dependent
s2  <- glmer(total.seeds~log.ros.area+trt + (1|plot), data = subset(Dodecatheon, total.seeds >0), family = "poisson")
anova(s1, s2, test="Chisq") #LTR test
s3  <- glmer(total.seeds~log.ros.area*trt + (1|plot), data = subset(Dodecatheon, total.seeds >0), family = "poisson")
anova(s1, s3, test="Chisq") #LTR test

#ok, for now, I just want number of seeds per capsule made on average
seeds <- mean(tot.seeds$total.seeds, na.rm = T) #80? seems fine for now



```
    

- Probability that a seed germinates:
    - The data we have for this: this will come from a combo of the seed addition data in the plots + the        seed pots [this will likely be the absolute max possible number, ie best possible conditions]
    
```{r}
seedgerm<-read.csv("/Users/Jenna/Dropbox/Williams' Lab/Cowichan IDE/Cowichan_DemographyData/Seed Addition/2022_seed_addition_counts.csv", header=T)
seedgerm <- seedgerm %>% select(plot, quadrant, no.primula) %>% 
  filter(quadrant == 4 | quadrant == 6)
av.germ <- seedgerm %>% 
  summarize(mean = mean(no.primula, na.rm = T))
av.germ$total <- av.germ$mean/40
##so, for all of the plots, I took the mean number of primula seedlings, then divided it by 40 (how many seeds we added) to get an average seed germination rate pf 0.022
```

- prob. that a flower makes seeds
    - the data we have for this: resurvey data in 2019, 2021, 2022 (2023)
    - eventually, will also vary this
    - Will this be plot or treatment specific? Will need to see how variable it is
    
```{r}
#what this df should look like: probability - so # flowers made and # that made remained/ had seeds?
# so this will come from the resurvey data from 2021-2023
## no.flowers started with:
#2019:
survey19 <- read.csv("C:/Users/Jenna/Dropbox/Williams' Lab/Cowichan IDE/Cowichan_DemographyData/Dodecatheon/2019_Dodecatheon_Demography_Data_Resurveys.csv")
survey19.end <- survey19 %>% 
  group_by(tag) %>% 
  arrange(date.surveyed) %>% 
  slice_head(n = 1) %>% 
  select(c(year, plot, tag, no.successful.cap)) %>% 
  mutate(year = as.character(year),
         plot = as.character(plot),
         tag = as.character(tag),
         no.successful.cap = as.numeric(no.successful.cap))
survey19.end <- na.omit(survey19.end)


#2021: have pseeds in the last column
survey21.end$year <- "2021"
survey21.end <- survey21.end %>% 
  rename(no.successful.cap = no.success.cap)

#2022:
survey22 <- read.csv("C:/Users/Jenna/Dropbox/Williams' Lab/Cowichan IDE/Cowichan_DemographyData/Dodecatheon/2022_Dodecatheon_Resurveys.csv")
survey22.end <- survey22 %>% 
  #filter(!is.na(pseeds)) %>% 
  #select(c(plot, tag, pseeds)) %>% 
  #mutate(year = "2022")
  group_by(tag) %>% 
  arrange(survey.date) %>% 
  slice_tail(n = 1) %>% 
  mutate(no.successful.cap = if_else(pseeds == 1, no.capsules, 0),
         year = "2022",
         plot = as.character(plot),
         tag = as.character(tag)) %>% 
  select(c(year, plot, tag, no.successful.cap))
survey22.end$no.successful.cap[survey22.end$tag == 839] <- 0

#2023:
survey23.end$year <-  "2023"
survey23.end <- survey23.end %>% 
  rename(initial.flower = no.at.start)

success <- bind_rows(survey19.end, survey21.end, survey22.end, survey23.end)
success <- success %>% 
  select(-seed.set)
#write.csv(success, "C:/Users/Jenna/Dropbox/Williams' Lab/Cowichan IDE/Cowichan_DemographyData/Dodecatheon/Dodecatheon_Fruitset.csv", row.names = F) #this is showign inital flowers and how many successful capsules


pseedset <- left_join(Dodecatheon, success)
pseedset <- pseedset %>% 
  filter(!is.na(no.successful.cap)) %>%
  mutate(initial.flower = if_else(is.na(initial.flower), no.flowers, initial.flower),
         initial.flower = if_else(initial.flower == 0, NA, initial.flower),
         pseedset = if_else(initial.flower == 0, 0, no.successful.cap/initial.flower))
pseedset %>% 
  ggplot(aes(trt, pseedset))+
  geom_boxplot()+
  facet_wrap(~year)
pseedset %>% 
  ggplot(aes(log.ros.area, pseedset))+
  geom_point()+
  facet_wrap(~trt)

pseeds.mean <- pseedset %>% 
  group_by(trt, year) %>% 
  summarize(pseedset = mean(pseedset, na.rm = T))


#do these match up with the total seeds file? yes, and fills in more! 
tot.seeds <- full_join(survey, tot.seeds) %>% 
  mutate(total.seeds = if_else(pseeds == 0, 0, total.seeds))
tot.seeds <- left_join(tot.seeds, plots)
#this might be skewed becuase it doesnt include plants that we didnt track (and stalks clipped etc?)

#average pseeds?
pseeds.mean <- tot.seeds %>% 
  #group_by(trt, year) %>% 
  summarize(mean.pseeds = mean(as.numeric(pseeds), na.rm = F))
#ok, not sure what to do here - is this the end values that I want?
#0.73 - probability a plant will make seeds?

##OH - It's inflated in 2021 because I caged plants. Duh. How to move forward here?
remove(survey21, survey22)
```
    
- Probability a 1-leaf stays a 1-leaf
    - The data we have for this: Toothpick data from 2021-2022 and 2022-2023 (if a toothpicked one leaf           plant stayed as a one leaf plant)
```{r}
#read in one leaf plants! And get toothpick data...
oneleaf<-read.csv("/Users/Jenna/Dropbox/Williams' Lab/Cowichan IDE/Cowichan_DemographyData/Dodecatheon/Dodecatheon_seedlings_allyears.csv", header=T)
oneleaf2022<-read.csv("/Users/Jenna/Dropbox/Williams' Lab/Cowichan IDE/Cowichan_DemographyData/Dodecatheon/2022_Dodecatheon_OneLeaf.csv", header=T)
oneleaf2023<-read.csv("/Users/Jenna/Dropbox/Williams' Lab/Cowichan IDE/Cowichan_DemographyData/Dodecatheon/2023_Dodecatheon_OneLeaf.csv", header=T)


oneleaf <- oneleaf%>% 
  rename(no.one.leaf = Seedling.number)

oneleaf_final <- bind_rows(oneleaf, oneleaf2022, oneleaf2023) %>% 
  select(-c(no.survivedTP, no.deadTP, no.placed.TP)) 
#oneleaf_final has the number of one leaf plants across all years

toothpick <- Dodecatheon %>% 
  filter(!is.na(toothpick)) %>% 
  select(c(year, plot, tag, Xcoor, Ycoor, toothpick, trt, no.smleaf, no.bigleaf, log.ros.area))
#the toothpick column indicates whether the new plant had a toothpick or not!
```
    
Ok, so the plan here is: 
"Can you look at how the number of one leaf plants/plot (or per treatment) varies across years - and here I would scale by area. From the above data, we can assume some fraction of them are new (⅔? ¾?). And then if we know the probability a seedling becomes a one leaf, we can back estimate how many seedlings there were the year before. Probably the most sensible thing is to calculate means per treatment. (this could go into the bootstrapping, or just keep it as the mean)

After doing this, write a few sentences in the methods describing what you did." (from Jenn)

```{r}
#so, here's the number of one leaf plants per plot and per treatment across years"

#one subplot is 1/4 of a sq.meter. = 0.25 sq.meters

total <- oneleaf_final %>% 
  group_by(Year, Plot) %>% 
  summarize(sum = sum(no.one.leaf, na.rm = T),
            non_na_count = sum(!is.na(no.one.leaf))) %>% 
  mutate(subplot.area = 0.25,
         area = subplot.area*non_na_count,
         leaf.per.area = round(sum/area, 0),
         Plot = as.factor(Plot)) %>% 
  rename(plot = Plot,
         year = Year) #this is accounting for the subplots that oneleafs werent counted in
total$leaf.per.area[is.nan(total$leaf.per.area)]<-0

total <- left_join(total, plots)
#total$Year <- as.factor(total$Year)


ggplot(total, aes(y = leaf.per.area, x = as.factor(year), color = trt))+
  geom_boxplot()+
    scale_color_manual(values = c(Z[3], Z[5], Z[1]))+
  labs(x = "Year", y = "One leaf plants per square meter")

ggplot(total, aes(y = leaf.per.area, x = as.factor(year), color = trt))+
  geom_boxplot()+
      scale_color_manual(values = c(Z[3], Z[5], Z[1]))+
  labs(x = "Year", y = "One leaf plants per square meter")+
  facet_wrap(~trt)
ggplot(total, aes(y = leaf.per.area, x = trt, color = trt))+
  geom_boxplot()+
      scale_color_manual(values = c(Z[3], Z[5], Z[1]))+
  labs(x = "", y = "One leaf plants per square meter")


mean(total$leaf.per.area)
tapply(total$leaf.per.area,total$trt, mean)

#so on average, 12 1-leafs per meter square

```



    
- Probability a 1-leaf graduates to the >1 leaf class
    - The data we have for this: toothpick data from 2021-2022 and 2022-2023 (if a toothpicked one leaf           plant survived and becomes a >1-leaf plant)
    
```{r}

```
    
    
- Probability that a seedling survives (to become a 1-leaf)
    - We don't have this data yet directly - will look in 2023 for true seedlings
    - BUT, we do have the number of flowers&seeds in each plot, and the number of 1-leaf plants 2 years 
    later. So we can do a bit of math to estimate this transition
    
```{r}

```
    
    
- Size distribution of new adults  (>1 leafers)
    - Mean and SD
    - This should be straightforward - what's the size distribution of newly tagged plants each year (be careful here with number of leaves, we have plants tagged that definitely only have one leaf!)
    - Actually, maybe not so straightforward - we didnt do number of leaves every year, and didnt always tag new plants, etc (in some plots, only tagged new flowering plants in half, or for clipping experiment...ugh)
    - Also need to look at how this varies across plot and year and treatment
    
```{r}

size.dist <- Dodecatheon %>%   
  mutate(leaves = if_else(year == 2022, no.smleaf + no.bigleaf, leaves)) %>% 
  filter(year == YrTag) %>% ##need to filter cases where year tagged == year (so newly tagged that year)
  filter(pflower == 0) %>% ## actual new plants definitely can't flower in the first year
  filter(leaves < 3)

#should this vary by treatment?? ie are new recruits different sizes across treatments?
ggplot(size.dist, aes(year, log.ros.area))+
  geom_boxplot()
m <- lmer(log.ros.area~1+(1|plot), data = size.dist)
m1 <- lmer(log.ros.area~trt+(1|plot), data = size.dist)
#nope, recruit size does not differ across trt
m <- lmer(log.ros.area~1+(1|plot), data = size.dist)
m1 <- lmer(log.ros.area~year+(1|plot), data = size.dist)
#so year does matter, but i wonder if it's because 2020 was a weird year and we didnt measure all the plants. maybe let's ignore this for now


anova(m, m1, test="Chisq") #LTR test
#here, I think let's not have differing values
size.dist <- size.dist %>% 
  dplyr::summarize(mean.new = mean(log.ros.area),
            sd.new = sd(log.ros.area))
#hmm this seems big...but maybe fine. I have it filtered out by year and plot so far

```

- What do tooth picked plants that live do?

```{r}
toothpick <- Dodecatheon %>% 
  filter(toothpick == "1") %>% 
  select(c(year, plot, tag, Xcoor, Ycoor, toothpick, trt, no.smleaf, no.bigleaf, log.ros.area)) %>% 
  mutate(no.leaves = sum(no.smleaf, no.bigleaf))

#toothpicked plant = they were a one leaf in t, and survived in t+1. A subset of these got tagged with a tag
#if the toothpick plant survives, X stay as 1 leaf, Y become adults (>1 leaves), there are 136 total

subset(toothpick, no.leaves == 1) #57
subset(toothpick, no.leaves >1) #79
#41.9% stayed 1 leaf
#58% grew to adult
subset(toothpick, no.leaves == 1 & year == "2022") #20
subset(toothpick, no.leaves >1& year == "2022") #55
#in 2022: 
#20/75 # 26.7% stayed as 1 leaf
#55/75 # 73.3% grew into an adult

subset(toothpick, no.leaves == 1 & year == "2023") #37
subset(toothpick, no.leaves >1& year == "2023") #24
#in 2023
#24/61 # 39.3% stayed 1 leaf
#37/61 # 60.7% grew to adult

subset(toothpick, no.leaves == 1 & trt == "drought") #16
subset(toothpick, no.leaves >1 & trt == "drought") #29

toothpick$status <- ifelse(toothpick$no.leaves == 1, "oneleaf", "adult")

chisq.test(toothpick$status, toothpick$year)
#yes differs across years
chisq.test(subset(toothpick, year == "2022")$status, subset(toothpick, year == "2022")$trt)
#trts do differ in 2022
chisq.test(subset(toothpick, year == "2023")$status, subset(toothpick, year == "2023")$trt)
#not in 2023

```

What to do with the 1-leaf data:
- I determined (thorugh the pot experiment) that plants stay as cotyledons their first year. This means that the 1-leaf plants that we called seedling are NOT seedling - so, we need to figure out a way to (1) add in a lagged year effect of seed production and one leaf plants (PROBLEM - how do we do probability of survival for this transition??). 
























This is code from 2020's ipm that I built in Jenn's course...

1. Making size distribution of seedlings: Need to find the mean+SD of area of 2 leaf plants:

```{r seedling mean size approx.}
twoleaf <- star %>%
  filter(leaves == "2")
mean(twoleaf$logros.area)
sdlg_sd <- sd(twoleaf$logros.area)
# mean of log(ros.area is 4.228311), SD = 0.661898
sdlg_mean <- 4.228311/2
# So size for seedlings will be 2.1142, SD = 0.6619
```
So size distrubution for seedlings will be _2.1142, SD = 0.6619_

2. Need the probability of flowering at size t0: 
3. Need the establishment prob proxy: how many seedlings will a flower the previous year produce?

```{r total number of flowers per plot at T0}
star_flowers <- star 
star_flowers$no.flowers[is.na(star_flowers$no.flowers)] <- 0

star_flowers <- star_flowers %>% 
  dplyr::select(year, plot, no.flowers) %>% 
  dplyr::filter(!year == "2016") %>% 
  dplyr::mutate(plot = as.factor(plot)) %>% 
  dplyr::group_by(year, plot) %>% 
  dplyr::summarize(flowers_per_plot = sum(no.flowers)) #how many flowers per plot per year
```

```{r number of seedlings per plot section at T1}
sdl <- dodeseedlings
sdl <- sdl %>% 
  dplyr::mutate(sub_ws = if_else(Seedling.number >= 0, 1, 0)) #plots with seedlings
sdl$sub_ws[is.na(sdl$sub_ws)] <- 0

sdl2 <- sdl %>% 
  dplyr::group_by(Year, Plot) %>% 
  dplyr::summarize(total = sum(sub_ws)) %>% 
  dplyr::mutate(plotpro = total/8)
sdl2 <- dplyr::rename(sdl2, "year" = "Year", "plot" = "Plot")#getting rid of capitals 
```

Seedlings weren't always counted in entire plot, although flowers were counted in whole plot (except 2016, as far as I know). So I will figure out the percentage of plot that seedlings were counted in and get the number of flowers that would be in that portion of the plot:

```{r number of flowers per section of plot that seedlings were counted in}
flower_tot <- merge(sdl2, star_flowers, by = c("year", "plot"))

flower_tot <- flower_tot %>% 
  dplyr::mutate(fec = plotpro*flowers_per_plot) # number of flowers per section of plot that seedlings were counted in!
```

```{r seedlings per plot }
sdl_plot <- sdl 

sdl_plot$Seedling.number[is.na(sdl_plot$Seedling.number)] <- 0
sdl_plot <- sdl_plot %>% 
  dplyr::group_by(Year, Plot) %>% 
  dplyr::summarize(sdl_sum = sum(Seedling.number))
sdl_plot <- dplyr::rename(sdl_plot, year = Year, plot = Plot) #getting rid of capitals 

fecundity <- merge(sdl_plot, flower_tot, by = c("year", "plot"))
```

My fecundity proxy will be: how many seedlings in t+1 each flower makes in t

```{r}
T_0<-fecundity
T_1<-fecundity

names(T_0) <- sub("sdl", "sdlT0", names(T_0))
names(T_0) <- sub("fec", "fecT0", names(T_0))


names(T_1) <- sub("sdl", "sdlT1", names(T_1))
names(T_1) <- sub("fec", "fecT1", names(T_1))


T_1$year <- T_1$year - 1
fec <- merge(T_0, T_1, by=c("year","plot"), all.x=TRUE)
fec <- fec %>% 
  dplyr::select(-c(total.x, plotpro.x, plotpro.y, total.y))
fec <- fec %>% 
  dplyr::mutate(sdl_sumT1 = sdlT1_sum, #sdl_sum = sum of counted seedlings in a plot next year
        adj_flowersT0=fecT0, #fec = adjusted flower number in plot at area that sdls counted in 
         proxy = sdl_sumT1/adj_flowersT0)
```

One problem: there are 2 plots that had no flowers in T0, but then seedlings T1, so my proxy solution is definitely not great, but is it good enough for the project? Sure
